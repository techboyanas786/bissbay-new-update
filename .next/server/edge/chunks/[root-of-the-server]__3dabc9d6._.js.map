{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'crypto')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`crypto`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,MAAM,CAAC"}},
    {"offset": {"line": 19, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'stream')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`stream`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,MAAM,CAAC"}},
    {"offset": {"line": 35, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'process')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`process`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,OAAO,CAAC"}},
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'net')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`net`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,GAAG,CAAC"}},
    {"offset": {"line": 43, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'tls')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`tls`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,GAAG,CAAC"}},
    {"offset": {"line": 47, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'timers')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`timers`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,MAAM,CAAC"}},
    {"offset": {"line": 51, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'string_decoder')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`string_decoder`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,cAAc,CAAC"}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'zlib')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`zlib`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,IAAI,CAAC"}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/Downloads/bissbay-new-main/bissbay-new-main/src/lib/db.js"],"sourcesContent":["import mysql from 'mysql2/promise';\n\nlet pool;\n\n// Create connection pool for better performance\nconst getPool = () => {\n    if (!pool) {\n        pool = mysql.createPool({\n            host: process.env.DATABASE_HOST || 'srv689.hstgr.io',\n            user: process.env.DATABASE_USER || 'u541369012_admin',\n            password: process.env.DATABASE_PASSWORD || 'x~!*U^7Z&R7&OkAB1f*R9',\n            database: process.env.DATABASE_NAME || 'u541369012_bissbay_2025',\n            port: 3306,\n            waitForConnections: true,\n            connectionLimit: 10,\n            maxIdle: 10,\n            idleTimeout: 60000,\n            queueLimit: 0,\n            enableKeepAlive: true,\n            keepAliveInitialDelay: 0\n        });\n    }\n    return pool;\n};\n\n// Get connection from pool\nexport const createConnection = async () => {\n    try {\n        const pool = getPool();\n        return await pool.getConnection();\n    } catch (error) {\n        console.error('Database connection failed:', error);\n        throw error;\n    }\n}\n\n// Execute query directly with pool (recommended)\nexport const query = async (sql, params) => {\n    try {\n        const pool = getPool();\n        return await pool.execute(sql, params);\n    } catch (error) {\n        console.error('Database query failed:', error);\n        throw error;\n    }\n}\n\nexport const closeConnection = async () => {\n    if (pool) {\n        await pool.end();\n        pool = null;\n    }\n}"],"names":[],"mappings":";;;;;;;;AAAA;;AAEA,IAAI;AAEJ,gDAAgD;AAChD,MAAM,UAAU;IACZ,IAAI,CAAC,MAAM;QACP,OAAO,qNAAK,CAAC,UAAU,CAAC;YACpB,MAAM,QAAQ,GAAG,CAAC,aAAa,IAAI;YACnC,MAAM,QAAQ,GAAG,CAAC,aAAa,IAAI;YACnC,UAAU,QAAQ,GAAG,CAAC,iBAAiB,IAAI;YAC3C,UAAU,QAAQ,GAAG,CAAC,aAAa,IAAI;YACvC,MAAM;YACN,oBAAoB;YACpB,iBAAiB;YACjB,SAAS;YACT,aAAa;YACb,YAAY;YACZ,iBAAiB;YACjB,uBAAuB;QAC3B;IACJ;IACA,OAAO;AACX;AAGO,MAAM,mBAAmB;IAC5B,IAAI;QACA,MAAM,OAAO;QACb,OAAO,MAAM,KAAK,aAAa;IACnC,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,MAAM;IACV;AACJ;AAGO,MAAM,QAAQ,OAAO,KAAK;IAC7B,IAAI;QACA,MAAM,OAAO;QACb,OAAO,MAAM,KAAK,OAAO,CAAC,KAAK;IACnC,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,0BAA0B;QACxC,MAAM;IACV;AACJ;AAEO,MAAM,kBAAkB;IAC3B,IAAI,MAAM;QACN,MAAM,KAAK,GAAG;QACd,OAAO;IACX;AACJ"}},
    {"offset": {"line": 119, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/Downloads/bissbay-new-main/bissbay-new-main/lib/auth-simple.js"],"sourcesContent":["import bcrypt from 'bcryptjs';\nimport jwt from 'jsonwebtoken';\n// Using Web Crypto API for Edge Runtime compatibility\nimport { createConnection } from '../src/lib/db.js';\n\n// Password policy enforcement\nexport const PASSWORD_POLICY = {\n  minLength: 12,\n  requireUppercase: true,\n  requireLowercase: true,\n  requireNumbers: true,\n  requireSpecialChars: true,\n  specialChars: '!@#$%^&*()_+-=[]{}|;:,.<>?'\n};\n\nexport function validatePassword(password) {\n  const errors = [];\n  \n  if (password.length < PASSWORD_POLICY.minLength) {\n    errors.push(`Password must be at least ${PASSWORD_POLICY.minLength} characters long`);\n  }\n  \n  if (PASSWORD_POLICY.requireUppercase && !/[A-Z]/.test(password)) {\n    errors.push('Password must contain at least one uppercase letter');\n  }\n  \n  if (PASSWORD_POLICY.requireLowercase && !/[a-z]/.test(password)) {\n    errors.push('Password must contain at least one lowercase letter');\n  }\n  \n  if (PASSWORD_POLICY.requireNumbers && !/\\d/.test(password)) {\n    errors.push('Password must contain at least one number');\n  }\n  \n  if (PASSWORD_POLICY.requireSpecialChars) {\n    const specialCharsRegex = new RegExp(`[${PASSWORD_POLICY.specialChars.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}]`);\n    if (!specialCharsRegex.test(password)) {\n      errors.push('Password must contain at least one special character (!@#$%^&*()_+-=[]{}|;:,.<>?)');\n    }\n  }\n  \n  return {\n    isValid: errors.length === 0,\n    errors\n  };\n}\n\nexport async function hashPassword(password) {\n  const saltRounds = 12;\n  const salt = await bcrypt.genSalt(saltRounds);\n  const hash = await bcrypt.hash(password, salt);\n  \n  return {\n    hash,\n    salt\n  };\n}\n\nexport async function verifyPassword(password, hash, salt) {\n  try {\n    return await bcrypt.compare(password, hash);\n  } catch (error) {\n    console.error('Password verification error:', error);\n    return false;\n  }\n}\n\nexport function generateJWT(payload) {\n  return jwt.sign(\n    payload,\n    process.env.JWT_SECRET,\n    { \n      expiresIn: process.env.JWT_EXPIRES_IN || '45m',\n      issuer: 'bissbay-admin',\n      audience: 'bissbay-admin-panel'\n    }\n  );\n}\n\nexport function verifyJWT(token) {\n  try {\n    return jwt.verify(token, process.env.JWT_SECRET, {\n      issuer: 'bissbay-admin',\n      audience: 'bissbay-admin-panel'\n    });\n  } catch (error) {\n    console.error('JWT verification error:', error);\n    return null;\n  }\n}\n\nexport function generateSecureToken() {\n  const array = new Uint8Array(64);\n  if (typeof window !== 'undefined') {\n    window.crypto.getRandomValues(array);\n  } else {\n    require('crypto').randomFillSync(array);\n  }\n  return Array.from(array, byte => byte.toString(16).padStart(2, '0')).join('');\n}\n\nexport async function createUser(username, password) {\n  const connection = await createConnection();\n  \n  try {\n    // Validate input\n    if (!username || !password) {\n      throw new Error('Username and password are required');\n    }\n    \n    if (username.length < 3 || username.length > 50) {\n      throw new Error('Username must be between 3 and 50 characters');\n    }\n    \n    // Validate username format (alphanumeric + underscore only)\n    if (!/^[a-zA-Z0-9_]+$/.test(username)) {\n      throw new Error('Username can only contain letters, numbers, and underscores');\n    }\n    \n    // Validate password\n    const passwordValidation = validatePassword(password);\n    if (!passwordValidation.isValid) {\n      throw new Error(`Password validation failed: ${passwordValidation.errors.join(', ')}`);\n    }\n    \n    // Check if user already exists\n    const [existingUser] = await connection.execute(\n      'SELECT id FROM admin_users WHERE username = ?',\n      [username]\n    );\n    \n    if (existingUser.length > 0) {\n      throw new Error('Username already exists');\n    }\n    \n    // Hash password\n    const { hash, salt } = await hashPassword(password);\n    \n    // Create user\n    const [result] = await connection.execute(\n      `INSERT INTO admin_users (username, password_hash, salt, password_changed_at) \n       VALUES (?, ?, ?, NOW())`,\n      [username, hash, salt]\n    );\n    \n    return {\n      id: result.insertId,\n      username,\n      created: true\n    };\n  } finally {\n    connection.release();\n  }\n}\n\nexport async function authenticateUser(username, password, ipAddress, userAgent) {\n  const connection = await createConnection();\n  \n  try {\n    const now = new Date();\n    console.log('Auth attempt - IP:', ipAddress, 'UserAgent:', userAgent);\n    \n    // Get user with lock check\n    const [users] = await connection.execute(\n      `SELECT id, username, password_hash, salt, failed_attempts, locked_until, is_active\n       FROM admin_users \n       WHERE username = ? AND is_active = TRUE`,\n      [username]\n    );\n    \n    if (users.length === 0) {\n      // Log failed attempt\n      await logLoginAttempt(connection, username, ipAddress, false, 'User not found', userAgent);\n      throw new Error('Invalid credentials');\n    }\n    \n    const user = users[0];\n    \n    // Check if account is locked\n    if (user.locked_until && new Date(user.locked_until) > now) {\n      await logLoginAttempt(connection, username, ipAddress, false, 'Account locked', userAgent);\n      const lockTimeRemaining = Math.ceil((new Date(user.locked_until) - now) / (1000 * 60));\n      throw new Error(`Account is locked. Try again in ${lockTimeRemaining} minutes.`);\n    }\n    \n    // Verify password\n    const isValidPassword = await verifyPassword(password, user.password_hash, user.salt);\n    \n    if (!isValidPassword) {\n      // Increment failed attempts\n      const newFailedAttempts = user.failed_attempts + 1;\n      const maxAttempts = parseInt(process.env.ADMIN_MAX_FAILED_ATTEMPTS) || 3;\n      const lockoutDuration = parseInt(process.env.ADMIN_LOCKOUT_DURATION) || 3600; // 1 hour in seconds\n      \n      let lockUntil = null;\n      if (newFailedAttempts >= maxAttempts) {\n        lockUntil = new Date(now.getTime() + lockoutDuration * 1000);\n      }\n      \n      await connection.execute(\n        'UPDATE admin_users SET failed_attempts = ?, locked_until = ? WHERE id = ?',\n        [newFailedAttempts, lockUntil, user.id]\n      );\n      \n      await logLoginAttempt(connection, username, ipAddress, false, 'Invalid password', userAgent);\n      \n      if (lockUntil) {\n        throw new Error('Too many failed attempts. Account has been locked for 1 hour.');\n      } else {\n        const remainingAttempts = maxAttempts - newFailedAttempts;\n        throw new Error(`Invalid credentials. ${remainingAttempts} attempts remaining.`);\n      }\n    }\n    \n    // Successful login - reset failed attempts and update last login\n    await connection.execute(\n      'UPDATE admin_users SET failed_attempts = 0, locked_until = NULL, last_login = NOW() WHERE id = ?',\n      [user.id]\n    );\n    \n    // Log successful login\n    await logLoginAttempt(connection, username, ipAddress, true, null, userAgent);\n    \n    // Create session\n    const sessionToken = generateSecureToken();\n    const expiresAt = new Date(now.getTime() + (parseInt(process.env.SESSION_MAX_AGE) || 2700) * 1000);\n    \n    await connection.execute(\n      `INSERT INTO admin_sessions (user_id, session_token, expires_at, ip_address, user_agent)\n       VALUES (?, ?, ?, ?, ?)`,\n      [user.id, sessionToken, expiresAt, ipAddress, userAgent]\n    );\n    \n    // Generate JWT\n    const jwtPayload = {\n      userId: user.id,\n      username: user.username,\n      sessionToken\n    };\n    \n    const token = generateJWT(jwtPayload);\n    \n    return {\n      success: true,\n      user: {\n        id: user.id,\n        username: user.username\n      },\n      token,\n      sessionToken,\n      expiresAt\n    };\n    \n  } finally {\n    connection.release();\n  }\n}\n\nexport async function validateSession(sessionToken) {\n  if (!sessionToken) return null;\n  \n  const connection = await createConnection();\n  \n  try {\n    const [sessions] = await connection.execute(\n      `SELECT s.*, u.username, u.is_active as user_active\n       FROM admin_sessions s\n       JOIN admin_users u ON s.user_id = u.id\n       WHERE s.session_token = ? AND s.expires_at > NOW() AND s.is_active = TRUE AND u.is_active = TRUE`,\n      [sessionToken]\n    );\n    \n    if (sessions.length === 0) {\n      return null;\n    }\n    \n    const session = sessions[0];\n    \n    // Session is valid, no need to update anything since admin_sessions doesn't have updated_at\n    // The session validation is sufficient\n    \n    return {\n      userId: session.user_id,\n      username: session.username,\n      sessionId: session.id\n    };\n  } finally {\n    connection.release();\n  }\n}\n\nexport async function logoutUser(sessionToken) {\n  if (!sessionToken) return;\n  \n  const connection = await createConnection();\n  \n  try {\n    await connection.execute(\n      'UPDATE admin_sessions SET is_active = FALSE WHERE session_token = ?',\n      [sessionToken]\n    );\n  } finally {\n    connection.release();\n  }\n}\n\nasync function logLoginAttempt(connection, username, ipAddress, success, failureReason, userAgent) {\n  try {\n    await connection.execute(\n      `INSERT INTO admin_login_attempts (username, ip_address, success, failure_reason, user_agent)\n       VALUES (?, ?, ?, ?, ?)`,\n      [username, ipAddress, success, failureReason, userAgent]\n    );\n  } catch (error) {\n    console.error('Failed to log login attempt:', error);\n  }\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 410, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/Downloads/bissbay-new-main/bissbay-new-main/middleware.js"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { validateSession } from './lib/auth-simple.js';\n\nexport async function middleware(request) {\n  const { pathname } = request.nextUrl;\n  \n  // Security headers for all requests\n  const response = NextResponse.next();\n  \n  // Set security headers\n  response.headers.set('X-Frame-Options', 'DENY');\n  response.headers.set('X-Content-Type-Options', 'nosniff');\n  response.headers.set('X-XSS-Protection', '1; mode=block');\n  response.headers.set('Referrer-Policy', 'strict-origin-when-cross-origin');\n  response.headers.set('Permissions-Policy', 'camera=(), microphone=(), geolocation=()');\n  \n  // Content Security Policy\n  const csp = [\n    \"default-src 'self'\",\n    \"script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.google.com https://www.gstatic.com\",\n    \"style-src 'self' 'unsafe-inline' https://fonts.googleapis.com\",\n    \"font-src 'self' https://fonts.gstatic.com\",\n    \"img-src 'self' data: https:\",\n    \"connect-src 'self' https://www.google.com\",\n    \"frame-src 'self' https://www.google.com\",\n    \"object-src 'none'\",\n    \"base-uri 'self'\",\n    \"form-action 'self'\"\n  ].join('; ');\n  \n  response.headers.set('Content-Security-Policy', csp);\n  \n  // Check if this is an admin route\n  if (pathname.startsWith('/admin')) {\n    // Allow login page and API routes to pass through - middleware shouldn't interfere with API routes\n    if (pathname === '/admin' || pathname.startsWith('/api/admin/')) {\n      return response;\n    }\n    \n    // For all other admin routes, verify authentication\n    try {\n      const sessionToken = request.cookies.get('admin-session')?.value;\n      \n      if (!sessionToken) {\n        return NextResponse.redirect(new URL('/admin', request.url));\n      }\n      \n      // Validate session\n      const sessionData = await validateSession(sessionToken);\n      \n      if (!sessionData) {\n        // Clear invalid cookie and redirect\n        const redirectResponse = NextResponse.redirect(new URL('/admin', request.url));\n        redirectResponse.cookies.set('admin-session', '', {\n          httpOnly: true,\n          secure: process.env.NODE_ENV === 'production',\n          sameSite: 'strict',\n          maxAge: 0,\n          path: '/admin'\n        });\n        return redirectResponse;\n      }\n      \n      // Add user info to request headers for use in components\n      response.headers.set('X-Admin-User-Id', sessionData.userId.toString());\n      response.headers.set('X-Admin-Username', sessionData.username);\n      \n    } catch (error) {\n      console.error('Middleware session validation error:', error);\n      return NextResponse.redirect(new URL('/admin', request.url));\n    }\n  }\n  \n  return response;\n}\n\nexport const config = {\n  matcher: [\n    /*\n     * Match all request paths except for the ones starting with:\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico (favicon file)\n     * - public files\n     */\n    '/((?!_next/static|_next/image|favicon.ico|public/).*)',\n  ],\n};"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;;;AAEO,eAAe,WAAW,OAAO;IACtC,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,oCAAoC;IACpC,MAAM,WAAW,iQAAY,CAAC,IAAI;IAElC,uBAAuB;IACvB,SAAS,OAAO,CAAC,GAAG,CAAC,mBAAmB;IACxC,SAAS,OAAO,CAAC,GAAG,CAAC,0BAA0B;IAC/C,SAAS,OAAO,CAAC,GAAG,CAAC,oBAAoB;IACzC,SAAS,OAAO,CAAC,GAAG,CAAC,mBAAmB;IACxC,SAAS,OAAO,CAAC,GAAG,CAAC,sBAAsB;IAE3C,0BAA0B;IAC1B,MAAM,MAAM;QACV;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD,CAAC,IAAI,CAAC;IAEP,SAAS,OAAO,CAAC,GAAG,CAAC,2BAA2B;IAEhD,kCAAkC;IAClC,IAAI,SAAS,UAAU,CAAC,WAAW;QACjC,mGAAmG;QACnG,IAAI,aAAa,YAAY,SAAS,UAAU,CAAC,gBAAgB;YAC/D,OAAO;QACT;QAEA,oDAAoD;QACpD,IAAI;YACF,MAAM,eAAe,QAAQ,OAAO,CAAC,GAAG,CAAC,kBAAkB;YAE3D,IAAI,CAAC,cAAc;gBACjB,OAAO,iQAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;YAC5D;YAEA,mBAAmB;YACnB,MAAM,cAAc,MAAM,IAAA,iNAAe,EAAC;YAE1C,IAAI,CAAC,aAAa;gBAChB,oCAAoC;gBACpC,MAAM,mBAAmB,iQAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;gBAC5E,iBAAiB,OAAO,CAAC,GAAG,CAAC,iBAAiB,IAAI;oBAChD,UAAU;oBACV,QAAQ,oDAAyB;oBACjC,UAAU;oBACV,QAAQ;oBACR,MAAM;gBACR;gBACA,OAAO;YACT;YAEA,yDAAyD;YACzD,SAAS,OAAO,CAAC,GAAG,CAAC,mBAAmB,YAAY,MAAM,CAAC,QAAQ;YACnE,SAAS,OAAO,CAAC,GAAG,CAAC,oBAAoB,YAAY,QAAQ;QAE/D,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,wCAAwC;YACtD,OAAO,iQAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC5D;IACF;IAEA,OAAO;AACT;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;;KAMC,GACD;KACD;AACH"}}]
}